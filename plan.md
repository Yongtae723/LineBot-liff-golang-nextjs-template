# LINE Bot + LIFF + Golang + Next.js Template - é–‹ç™ºè¨ˆç”»æ›¸

## ğŸ“‹ ç›®æ¬¡
1. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦](#1-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#2-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#3-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
4. [ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ](#4-ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ )
5. [å®Ÿè£…è¨ˆç”»](#5-å®Ÿè£…è¨ˆç”»)
6. [èªè¨¼ãƒ•ãƒ­ãƒ¼](#6-èªè¨¼ãƒ•ãƒ­ãƒ¼)
7. [ä¼šè©±åŒæœŸã®ä»•çµ„ã¿](#7-ä¼šè©±åŒæœŸã®ä»•çµ„ã¿)
8. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#8-é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
9. [ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥](#9-ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥)
10. [READMEæ§‹æˆ](#10-readmeæ§‹æˆ)

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1.1 ç›®çš„
ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¯ã€LINE Botã¨LIFFï¼ˆLINE Front-end Frameworkï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGemini LLMã¨ä¼šè©±ã§ãã‚‹çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®å†åˆ©ç”¨å¯èƒ½ãªãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚LINE Botã§ã®ä¼šè©±ã¨LIFFã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã§ã®ä¼šè©±ãŒå®Œå…¨ã«åŒæœŸã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã©ã¡ã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰ã§ã‚‚ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ã«ä¼šè©±ã‚’ç¶™ç¶šã§ãã¾ã™ã€‚

### 1.2 ä¸»ãªç‰¹å¾´
- **çµ±åˆã•ã‚ŒãŸä¼šè©±ä½“é¨“**: LINE Botã¨LIFFã§åŒã˜ä¼šè©±å±¥æ­´ã‚’å…±æœ‰
- **Gemini LLMçµ±åˆ**: Google Geminiã‚’ä½¿ç”¨ã—ãŸé«˜åº¦ãªä¼šè©±æ©Ÿèƒ½
- **å …ç‰¢ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: LINE LIFFèªè¨¼ã¨Supabaseèªè¨¼ã®çµ±åˆ
- **ãƒ¢ãƒ€ãƒ³ãªæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Golangï¼ˆbackendï¼‰+ Next.jsï¼ˆfrontendï¼‰
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹å¿—å‘ã®è¨­è¨ˆ
- **å®Œå…¨ãªãƒ¢ãƒãƒ¬ãƒæ§‹æˆ**: Go Workspaceã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªé–‹ç™º
- **æœ¬ç•ªç’°å¢ƒå¯¾å¿œ**: Dockerã€Cloud Runã€Cloudflareã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šå®Œå‚™

### 1.3 å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- LINEã‚’æ´»ç”¨ã—ãŸãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‚’æ§‹ç¯‰ã—ãŸã„é–‹ç™ºè€…
- Golangã¨Next.jsã‚’ä½¿ã£ãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯é–‹ç™ºã‚’å­¦ã³ãŸã„ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
- ä¼šè©±å±¥æ­´ã®åŒæœŸãŒå¿…è¦ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã—ãŸã„ãƒãƒ¼ãƒ 
- Supabaseã‚’ä½¿ã£ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰é–‹ç™ºã«èˆˆå‘³ãŒã‚ã‚‹é–‹ç™ºè€…

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 2.1 Backend
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **Go** | 1.24.2 | ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª |
| **Gin** | latest | Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯REST APIæ§‹ç¯‰ |
| **Go Workspaces** | - | ãƒ¢ãƒãƒ¬ãƒç®¡ç† |
| **Supabase Go Client** | latest | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ |
| **LINE Bot SDK** | v8 | LINE Messaging APIçµ±åˆ |
| **Google Gemini API** | latest | LLMçµ±åˆ |
| **zerolog** | latest | æ§‹é€ åŒ–ãƒ­ã‚° |
| **Mage** | latest | ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒŠãƒ¼ |
| **mockery** | v2 | ãƒ¢ãƒƒã‚¯ç”Ÿæˆ |
| **testify** | latest | ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |

### 2.2 Frontend (LIFF)
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| **Next.js** | 15.x | React ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆApp Routerï¼‰ |
| **React** | 19.x | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| **TypeScript** | 5.x | å‹å®‰å…¨æ€§ |
| **Tailwind CSS** | 3.x | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| **shadcn/ui** | latest | UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| **@line/liff** | latest | LIFF SDK |
| **@supabase/ssr** | latest | Supabase SSR |
| **Biome** | latest | ãƒªãƒ³ã‚¿ãƒ¼ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼ |

### 2.3 Infrastructure
| æŠ€è¡“ | ç”¨é€” |
|------|------|
| **Supabase** | PostgreSQLã€Authenticationã€Row Level Security |
| **Google Cloud Run** | Golang ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° |
| **Cloudflare Pages** | LIFFã‚¢ãƒ—ãƒªã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° |
| **Docker** | ã‚³ãƒ³ãƒ†ãƒŠåŒ– |
| **GitHub Actions** | CI/CD |

---

## 3. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 3.1 å…¨ä½“æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LINE Platform                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  LINE Bot   â”‚                          â”‚    LIFF     â”‚       â”‚
â”‚  â”‚  (Messaging â”‚                          â”‚  (Web App)  â”‚       â”‚
â”‚  â”‚     API)    â”‚                          â”‚             â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                         â”‚
          â”‚ Webhook                                 â”‚ HTTPS
          â”‚                                         â”‚
          â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LINE Bot      â”‚                    â”‚   LIFF Frontend    â”‚
â”‚   Service       â”‚                    â”‚   (Next.js)        â”‚
â”‚   (Golang/Gin)  â”‚                    â”‚                    â”‚
â”‚   Port: 8000    â”‚                    â”‚   Cloudflare       â”‚
â”‚   Cloud Run     â”‚                    â”‚   Pages            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                       â”‚
         â”‚                                       â”‚ REST API
         â”‚                                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚
         â”‚              â–¼
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    â”‚   Backend API   â”‚
         â”‚    â”‚   (Golang/Gin)  â”‚
         â”‚    â”‚   Port: 8080    â”‚
         â”‚    â”‚   Cloud Run     â”‚
         â””â”€â”€â”€â–¶â”‚                 â”‚
              â”‚  Auth Middlewareâ”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Supabase Client
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Supabase      â”‚
              â”‚                 â”‚
              â”‚  - PostgreSQL   â”‚
              â”‚  - Auth         â”‚
              â”‚  - RPC          â”‚
              â”‚  - RLS          â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ (Conversation Table)
                       â”‚ user_id | message | role | created_at
                       â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                     â”‚
                                                     â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  Gemini API      â”‚
                                          â”‚  (Google Cloud)  â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Shared Go Package                        â”‚
â”‚  (go_pkg)                                                   â”‚
â”‚                                                              â”‚
â”‚  - models/        : ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«                            â”‚
â”‚  - repository/    : Supabase ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤               â”‚
â”‚  - llm/          : Gemini ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ                      â”‚
â”‚  - mage/         : ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯å®šç¾©                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### 3.2.1 LINE Botã§ã®ä¼šè©±ãƒ•ãƒ­ãƒ¼
```
1. User sends message via LINE
   â†“
2. LINE Platform sends webhook to LINE Bot Service
   â†“
3. LINE Bot Service:
   - Extracts user_id (LINE User ID)
   - Fetches conversation history from Supabase
   - Calls Gemini API with context
   â†“
4. Gemini API returns response
   â†“
5. LINE Bot Service:
   - Saves user message and bot response to Supabase
   - Sends response back to LINE Platform
   â†“
6. LINE Platform delivers message to user
```

#### 3.2.2 LIFF Appã§ã®ä¼šè©±ãƒ•ãƒ­ãƒ¼
```
1. User opens LIFF in LINE
   â†“
2. LIFF App:
   - Initializes LIFF SDK
   - Gets LINE Access Token
   - Calls Backend API for authentication
   â†“
3. Backend API:
   - Verifies LINE token
   - Creates/retrieves Supabase user
   - Returns Supabase session token
   â†“
4. LIFF App stores session and renders chat UI
   â†“
5. User sends message via LIFF
   â†“
6. LIFF App calls Backend API with message
   â†“
7. Backend API:
   - Validates Supabase JWT
   - Fetches conversation history
   - Calls Gemini API
   - Saves to Supabase
   - Returns response
   â†“
8. LIFF App displays response in UI
```

### 3.3 ä¼šè©±ã®åŒæœŸãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

**å…±é€šãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
```sql
conversations (
  id UUID PRIMARY KEY,
  user_id TEXT NOT NULL,  -- LINE User ID
  role TEXT NOT NULL,     -- 'user' or 'assistant'
  content TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
)
```

**åŒæœŸã®ãƒã‚¤ãƒ³ãƒˆ:**
- LINE Bot Serviceã¨Backend APIã¯åŒã˜Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’å‚ç…§
- ä¸¡ã‚µãƒ¼ãƒ“ã‚¹ã¯åŒã˜`conversations`ãƒ†ãƒ¼ãƒ–ãƒ«ã«èª­ã¿æ›¸ã
- `user_id`ï¼ˆLINE User IDï¼‰ã§ä¼šè©±ã‚’è­˜åˆ¥
- æ™‚ç³»åˆ—é †ï¼ˆcreated_atï¼‰ã§ä¼šè©±å±¥æ­´ã‚’å–å¾—

---

## 4. ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ 

### 4.1 æœ€çµ‚çš„ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ 

```
LineBot-liff-golang-nextjs-template/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ backend-deploy.yml        # Backend API ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â”œâ”€â”€ line-bot-deploy.yml       # LINE Bot ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â”œâ”€â”€ liff-deploy.yml           # LIFF ãƒ‡ãƒ—ãƒ­ã‚¤
â”‚       â””â”€â”€ test.yml                  # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
â”‚
â”œâ”€â”€ go_pkg/                           # å…±é€š Golang ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ llm/
â”‚   â”‚   â”œâ”€â”€ gemini.go                 # Gemini ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå®Ÿè£…
â”‚   â”‚   â”œâ”€â”€ llm.go                    # LLM ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ http.go                   # HTTPãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ mock_llmclient.go         # ãƒ¢ãƒƒã‚¯ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ conversation.go           # ä¼šè©±ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ user.go                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ base.go                   # Supabase åˆæœŸåŒ–
â”‚   â”‚   â”œâ”€â”€ conversation.go           # ä¼šè©±ãƒªãƒã‚¸ãƒˆãƒª
â”‚   â”‚   â”œâ”€â”€ user.go                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªãƒã‚¸ãƒˆãƒª
â”‚   â”‚   â””â”€â”€ mock_*.go                 # ãƒ¢ãƒƒã‚¯ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ mage/
â”‚   â”‚   â”œâ”€â”€ commands.go               # å…±é€š Mage ã‚³ãƒãƒ³ãƒ‰
â”‚   â”‚   â””â”€â”€ version.go                # ãƒãƒ¼ã‚¸ãƒ§ãƒ³å®šç¾©
â”‚   â”œâ”€â”€ .mockery.yaml                 # mockery è¨­å®š
â”‚   â”œâ”€â”€ go.mod
â”‚   â”œâ”€â”€ go.sum
â”‚   â”œâ”€â”€ mage.go
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ backend/                          # Backend API ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â””â”€â”€ main.go                   # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go                 # ç’°å¢ƒå¤‰æ•°ãƒ­ãƒ¼ãƒ€ãƒ¼
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.go                   # Supabase JWT èªè¨¼
â”‚   â”‚   â””â”€â”€ cors.go                   # CORS è¨­å®š
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ router.go                 # ãƒ«ãƒ¼ãƒˆå®šç¾©
â”‚   â”‚   â”œâ”€â”€ conversation.go           # ä¼šè©±ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ user.go                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ logic/
â”‚   â”‚   â”œâ”€â”€ conversation/
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.go            # ä¼šè©±ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”‚   â””â”€â”€ handler_test.go
â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚       â”œâ”€â”€ register.go           # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚       â””â”€â”€ register_test.go
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ go.mod
â”‚   â”œâ”€â”€ go.sum
â”‚   â”œâ”€â”€ mage.go
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ line_bot/                         # LINE Bot ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â””â”€â”€ main.go
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ signature.go              # LINEç½²åæ¤œè¨¼
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ router.go
â”‚   â”‚   â””â”€â”€ webhook.go                # Webhook ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”œâ”€â”€ logic/
â”‚   â”‚   â””â”€â”€ message/
â”‚   â”‚       â”œâ”€â”€ handler.go            # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚       â””â”€â”€ handler_test.go
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ go.mod
â”‚   â”œâ”€â”€ go.sum
â”‚   â”œâ”€â”€ mage.go
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ liff/                             # LIFF ã‚¢ãƒ—ãƒª (Next.js)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ (authenticated)/      # èªè¨¼å¿…é ˆãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx      # ãƒãƒ£ãƒƒãƒˆç”»é¢
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx          # ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â”‚   â””â”€â”€ globals.css
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                   # shadcn/ui ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatContainer.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageBubble.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ InputBar.tsx
â”‚   â”‚   â”‚   â””â”€â”€ providers/
â”‚   â”‚   â”‚       â””â”€â”€ LiffProvider.tsx  # LIFFåˆæœŸåŒ–
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client.ts         # Supabase ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts         # ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ç”¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ middleware.ts     # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ client.ts         # Backend API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”‚   â””â”€â”€ liff/
â”‚   â”‚   â”‚       â””â”€â”€ init.ts           # LIFFåˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”œâ”€â”€ conversation.ts
â”‚   â”‚   â”‚   â””â”€â”€ supabase.ts           # è‡ªå‹•ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ middleware.ts             # Next.js ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ .env.local.example
â”‚   â”œâ”€â”€ biome.json
â”‚   â”œâ”€â”€ next.config.mjs
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ wrangler.toml                 # Cloudflare è¨­å®š
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ supabase/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ 20250101000000_initial_schema.sql
â”‚   â”œâ”€â”€ seed.sql                      # åˆæœŸãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ config.toml
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ ARCHITECTURE.md               # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°
â”‚   â”œâ”€â”€ DEVELOPMENT.md                # é–‹ç™ºã‚¬ã‚¤ãƒ‰
â”‚   â”œâ”€â”€ DEPLOYMENT.md                 # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰
â”‚   â””â”€â”€ API.md                        # APIä»•æ§˜æ›¸
â”‚
â”œâ”€â”€ .cursor/
â”‚   â””â”€â”€ rules/
â”‚       â”œâ”€â”€ general.mdc               # ä¸€èˆ¬ãƒ«ãƒ¼ãƒ«
â”‚       â”œâ”€â”€ golang.mdc                # Goé–‹ç™ºãƒ«ãƒ¼ãƒ«
â”‚       â””â”€â”€ liff.mdc                  # LIFFé–‹ç™ºãƒ«ãƒ¼ãƒ«
â”‚
â”œâ”€â”€ .gitignore
â”œâ”€â”€ go.work                           # Go Workspace å®šç¾©
â”œâ”€â”€ go.work.sum
â”œâ”€â”€ LICENSE
â””â”€â”€ README.md                         # ãƒ¡ã‚¤ãƒ³README
```

### 4.2 cookLabã‹ã‚‰ã®æŠ½å‡ºæ–¹é‡

| cookLabã®è¦ç´  | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã®æ‰±ã„ | ç†ç”± |
|--------------|-------------------|------|
| **go_pkg/llm/** | âœ… ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ | Geminiçµ±åˆã®ã‚³ã‚¢æ©Ÿèƒ½ |
| **go_pkg/repository/** | âœ… ç°¡ç•¥åŒ–ã—ã¦ã‚³ãƒ”ãƒ¼ | conversation, userã®ã¿ã«é™å®š |
| **go_pkg/models/** | âœ… ç°¡ç•¥åŒ–ã—ã¦ã‚³ãƒ”ãƒ¼ | conversation, userã®ã¿ã«é™å®š |
| **go_pkg/mage/** | âœ… ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ | ãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ã®æ¨™æº–åŒ– |
| **backend-service/middleware/auth** | âœ… ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ | Supabase JWTèªè¨¼ |
| **backend-service/config/** | âœ… ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ | ç’°å¢ƒå¤‰æ•°ç®¡ç† |
| **line_bot_golang/** | âœ… ç°¡ç•¥åŒ–ã—ã¦ã‚³ãƒ”ãƒ¼ | ä¼šè©±æ©Ÿèƒ½ã®ã¿ã«é™å®š |
| **liff-app/auth/** | âœ… ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ | LINE â†’ Supabaseèªè¨¼ãƒ•ãƒ­ãƒ¼ |
| **liff-app/components/ui/** | âœ… shadcn/uiã§å†å®Ÿè£… | æ±ç”¨çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| **supabase/migrations/** | âš ï¸ æœ€å°é™ã®ã‚¹ã‚­ãƒ¼ãƒã®ã¿ | users, conversationsãƒ†ãƒ¼ãƒ–ãƒ«ã®ã¿ |
| **recipeé–¢é€£ã®æ©Ÿèƒ½** | âŒ é™¤å¤– | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç¯„å›²å¤– |
| **stripeé–¢é€£ã®æ©Ÿèƒ½** | âŒ é™¤å¤– | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç¯„å›²å¤– |

---

## 5. å®Ÿè£…è¨ˆç”»

### 5.1 Phase 1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŸºç›¤æ§‹ç¯‰ï¼ˆStep 1-5ï¼‰âœ… å®Œäº†

#### Step 1: ãƒªãƒã‚¸ãƒˆãƒªåˆæœŸåŒ–ã¨Go Workspaceè¨­å®š âœ…
**ä½œæ¥­å†…å®¹:**
- [x] `.gitignore`ä½œæˆï¼ˆcookLabã‹ã‚‰å‚è€ƒï¼‰
- [x] `go.work`ä½œæˆï¼ˆ3ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: go_pkg, backend, line_botï¼‰
- [x] å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`go.mod`åˆæœŸåŒ–
- [x] ãƒ©ã‚¤ã‚»ãƒ³ã‚¹é¸å®šï¼ˆMITæ¨å¥¨ï¼‰

**æˆæœç‰©:**
```
.gitignore
go.work
LICENSE
```

**å®Ÿè£…ãƒ¡ãƒ¢:**
- Go Workspaceã§3ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’çµ±åˆç®¡ç†
- å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆgo_pkgï¼‰ã‚’local replaceã§å‚ç…§
- MIT Licenseã‚’æ¡ç”¨

#### Step 2: go_pkg - å…±é€šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ§‹ç¯‰ âœ…
**ä½œæ¥­å†…å®¹:**
- [x] `go_pkg/models/`
  - `conversation.go`: ä¼šè©±ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
  - `user.go`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
- [x] `go_pkg/repository/`
  - `base.go`: SupabaseåˆæœŸåŒ–ï¼ˆcookLabã‹ã‚‰ã‚³ãƒ”ãƒ¼ï¼‰
  - `conversation.go`: ä¼šè©±CRUDæ“ä½œ
  - `user.go`: ãƒ¦ãƒ¼ã‚¶ãƒ¼CRUDæ“ä½œ
  - `auth.go`: Supabase Auth Admin APIçµ±åˆ
- [x] `go_pkg/llm/`
  - `gemini.go`: Geminiã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆcookLabã‹ã‚‰ç°¡ç•¥åŒ–ï¼‰
  - `http.go`: HTTPãƒªãƒˆãƒ©ã‚¤ï¼ˆcookLabã‹ã‚‰ã‚³ãƒ”ãƒ¼ï¼‰
- [x] `go_pkg/mage/`
  - `magefile.go`: Mageã‚³ãƒãƒ³ãƒ‰ï¼ˆmockeryç”Ÿæˆï¼‰
- [x] `.mockery.yaml`è¨­å®š
- [x] `mage.go`ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆä½œæˆ
- [x] `go_pkg/README.md`ä½œæˆ

**å®Ÿè£…ãƒ¡ãƒ¢:**
- `llm.GoogleGemini`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯`Chat`ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ã«ç°¡ç•¥åŒ–
- `models.Conversation`ã‚’ç›´æ¥ä½¿ç”¨ã—ã¦LLMã¨é€£æº
- `repository.AuthRepo`ã‚’è¿½åŠ ã—ã¦Supabase Auth Admin APIæ“ä½œã‚’åˆ†é›¢
- Geminiãƒ¢ãƒ‡ãƒ«: `gemini-2.5-flash-lite`ã‚’ä½¿ç”¨

**é‡è¦ãªå®Ÿè£…è©³ç´°:**

**models/conversation.go:**
```go
package models

import "time"

type Conversation struct {
    ID        string    `json:"id" db:"id"`
    UserID    string    `json:"user_id" db:"user_id"`
    Role      string    `json:"role" db:"role"` // "user" or "assistant"
    Content   string    `json:"content" db:"content"`
    CreatedAt time.Time `json:"created_at" db:"created_at"`
}

const (
    RoleUser      = "user"
    RoleAssistant = "assistant"
)
```

**models/user.go:**
```go
package models

import "time"

type User struct {
    ID        string    `json:"id" db:"id"`           // Supabase Auth UUID
    LineID    string    `json:"line_id" db:"line_id"` // LINE User ID
    Name      string    `json:"name" db:"name"`
    CreatedAt time.Time `json:"created_at" db:"created_at"`
    UpdatedAt time.Time `json:"updated_at" db:"updated_at"`
}
```

**repository/conversation.go:**
```go
package repository

import (
    "context"
    "fmt"
    "github.com/supabase-community/postgrest-go"
    "your-module/go_pkg/models"
)

type ConversationRepo interface {
    GetByUserID(ctx context.Context, userID string, limit int) ([]*models.Conversation, error)
    Create(ctx context.Context, conv *models.Conversation) error
}

type conversationRepo struct {
    *BaseRepo
}

func NewConversationRepo() ConversationRepo {
    return &conversationRepo{BaseRepo: baseRepo}
}

func (r *conversationRepo) GetByUserID(ctx context.Context, userID string, limit int) ([]*models.Conversation, error) {
    var conversations []*models.Conversation
    _, err := r.Client.From("conversations").
        Select("*", "", false).
        Eq("user_id", userID).
        Order("created_at", &postgrest.OrderOpts{Ascending: true}).
        Limit(limit, "").
        ExecuteTo(&conversations)
    if err != nil {
        return nil, fmt.Errorf("repository: failed to get conversations: %w", err)
    }
    return conversations, nil
}

func (r *conversationRepo) Create(ctx context.Context, conv *models.Conversation) error {
    _, err := r.Client.From("conversations").
        Insert(conv, false, "", "", "").
        Execute()
    if err != nil {
        return fmt.Errorf("repository: failed to create conversation: %w", err)
    }
    return nil
}
```

#### Step 3: Supabaseã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ âœ…
**ä½œæ¥­å†…å®¹:**
- [x] Supabaseãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒæ§‹ç¯‰
- [x] `supabase/initial_setup.sql`ä½œæˆï¼ˆGUI + `supabase db diff`ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç”¨ï¼‰
  - `users`ãƒ†ãƒ¼ãƒ–ãƒ«
  - `conversations`ãƒ†ãƒ¼ãƒ–ãƒ«
  - RLSï¼ˆRow Level Securityï¼‰ãƒãƒªã‚·ãƒ¼
  - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  - Triggerï¼ˆupdated_atè‡ªå‹•æ›´æ–°ï¼‰
- [x] `supabase/config.toml`ä½œæˆ
- [x] `supabase/README.md`ä½œæˆï¼ˆè©³ç´°ãªæ‰‹é †æ›¸ï¼‰

**å®Ÿè£…ãƒ¡ãƒ¢:**
- GUI-First + Migration File ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’æ¡ç”¨
- `supabase db diff -f migration_name`ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ
- RLSãƒãƒªã‚·ãƒ¼ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢ã‚’å®Ÿè£…
- `conversations.user_id`ã¯LINE User IDã‚’ä½¿ç”¨ï¼ˆåŒæœŸã®è¦ï¼‰

**åˆæœŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**
```sql
-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Users table (connected to auth.users)
CREATE TABLE public.users (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  line_id TEXT UNIQUE NOT NULL,
  name TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Conversations table
CREATE TABLE public.conversations (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  user_id TEXT NOT NULL, -- LINE User ID for easy lookup
  role TEXT NOT NULL CHECK (role IN ('user', 'assistant')),
  content TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_conversations_user_id ON public.conversations(user_id);
CREATE INDEX idx_conversations_created_at ON public.conversations(created_at DESC);
CREATE INDEX idx_users_line_id ON public.users(line_id);

-- RLS Policies
ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.conversations ENABLE ROW LEVEL SECURITY;

-- Users can read their own data
CREATE POLICY "Users can view own data"
  ON public.users FOR SELECT
  USING (auth.uid() = id);

-- Users can update their own data
CREATE POLICY "Users can update own data"
  ON public.users FOR UPDATE
  USING (auth.uid() = id);

-- Users can view their own conversations (via line_id in auth metadata)
CREATE POLICY "Users can view own conversations"
  ON public.conversations FOR SELECT
  USING (
    user_id = (
      SELECT line_id FROM public.users WHERE id = auth.uid()
    )
  );

-- Users can insert their own conversations
CREATE POLICY "Users can insert own conversations"
  ON public.conversations FOR INSERT
  WITH CHECK (
    user_id = (
      SELECT line_id FROM public.users WHERE id = auth.uid()
    )
  );

-- Function to update updated_at timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Trigger for users table
CREATE TRIGGER update_users_updated_at
  BEFORE UPDATE ON public.users
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at_column();
```

#### Step 4: Backend API ã‚µãƒ¼ãƒ“ã‚¹æ§‹ç¯‰ âœ…
**ä½œæ¥­å†…å®¹:**
- [x] `backend/cmd/main.go`ä½œæˆ
  - GinåˆæœŸåŒ–
  - SupabaseåˆæœŸåŒ–
  - ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
- [x] `backend/config/config.go`ä½œæˆï¼ˆç’°å¢ƒå¤‰æ•°ãƒ­ãƒ¼ãƒ€ãƒ¼ï¼‰
- [x] `backend/middleware/auth.go`ä½œæˆï¼ˆSupabase JWTèªè¨¼ï¼‰
- [x] `backend/middleware/cors.go`ä½œæˆ
- [x] `backend/routes/router.go`ä½œæˆ
- [x] `backend/routes/user.go`ä½œæˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- [x] `backend/routes/conversation.go`ä½œæˆï¼ˆä¼šè©±ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- [x] `backend/logic/user/register.go`ä½œæˆ
- [x] `backend/logic/conversation/handler.go`ä½œæˆ
- [x] `backend/Dockerfile`ä½œæˆ
- [x] `backend/.env.example`ä½œæˆ
- [x] `backend/README.md`ä½œæˆ

**å®Ÿè£…ãƒ¡ãƒ¢:**
- **Method-Level DI**: ãƒ«ãƒ¼ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†…ã§ä¾å­˜é–¢ä¿‚ã‚’åˆæœŸåŒ–
- **LINEèªè¨¼çµ±åˆ**: LINE Access Tokenæ¤œè¨¼ + Supabase Authé€£æº
- **ç°¡ç•¥åŒ–ã•ã‚ŒãŸèªè¨¼ãƒ•ãƒ­ãƒ¼**: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”¨ã«LineIDã‚’ç›´æ¥emailã¨ã—ã¦ä½¿ç”¨
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
  - `POST /api/v1/user/register`: LINE tokenã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
  - `GET /api/v1/conversations`: ä¼šè©±å±¥æ­´å–å¾—ï¼ˆèªè¨¼å¿…é ˆï¼‰
  - `POST /api/v1/conversations`: æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆèªè¨¼å¿…é ˆï¼‰
- **Geminiçµ±åˆ**: gemini-2.5-flash-liteãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨

**ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
POST   /api/v1/user/register          # LINE tokenã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
GET    /api/v1/conversations           # ä¼šè©±å±¥æ­´å–å¾—
POST   /api/v1/conversations           # æ–°ã—ã„ä¼šè©±ã‚’é€ä¿¡
```

**backend/routes/conversation.go:**
```go
package routes

import (
    "net/http"
    "strconv"
    "github.com/gin-gonic/gin"
    "your-module/backend/logic/conversation"
)

type ConversationRequest struct {
    Message string `json:"message" binding:"required"`
}

type ConversationResponse struct {
    Response string `json:"response"`
}

func GetConversations(c *gin.Context) {
    userID, exists := c.Get("user_id")
    if !exists {
        c.JSON(http.StatusUnauthorized, gin.H{"error": "user not authenticated"})
        return
    }

    limitStr := c.DefaultQuery("limit", "50")
    limit, err := strconv.Atoi(limitStr)
    if err != nil {
        limit = 50
    }

    handler := conversation.NewHandler()
    conversations, err := handler.GetHistory(c.Request.Context(), userID.(string), limit)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
        return
    }

    c.JSON(http.StatusOK, conversations)
}

func PostConversation(c *gin.Context) {
    userID, exists := c.Get("user_id")
    if !exists {
        c.JSON(http.StatusUnauthorized, gin.H{"error": "user not authenticated"})
        return
    }

    var req ConversationRequest
    if err := c.ShouldBindJSON(&req); err != nil {
        c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
        return
    }

    handler := conversation.NewHandler()
    response, err := handler.ProcessMessage(c.Request.Context(), userID.(string), req.Message)
    if err != nil {
        c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
        return
    }

    c.JSON(http.StatusOK, ConversationResponse{Response: response})
}
```

**backend/logic/conversation/handler.go:**
```go
package conversation

import (
    "context"
    "fmt"
    "github.com/google/uuid"
    "your-module/go_pkg/llm"
    "your-module/go_pkg/models"
    "your-module/go_pkg/repository"
)

type Handler struct {
    convRepo repository.ConversationRepo
    userRepo repository.UserRepo
    llm      llm.GoogleGemini
}

func NewHandler() *Handler {
    ctx := context.Background()
    geminiClient, err := llm.NewGoogleGemini(
        ctx,
        os.Getenv("GEMINI_API_KEY"),
        "gemini-1.5-flash",
    )
    if err != nil {
        panic(fmt.Sprintf("failed to create gemini client: %v", err))
    }

    return &Handler{
        convRepo: repository.NewConversationRepo(),
        userRepo: repository.NewUserRepo(),
        llm:      geminiClient,
    }
}

func (h *Handler) GetHistory(ctx context.Context, userID string, limit int) ([]*models.Conversation, error) {
    user, err := h.userRepo.GetByID(ctx, userID)
    if err != nil {
        return nil, fmt.Errorf("failed to get user: %w", err)
    }

    conversations, err := h.convRepo.GetByUserID(ctx, user.LineID, limit)
    if err != nil {
        return nil, fmt.Errorf("failed to get conversations: %w", err)
    }

    return conversations, nil
}

func (h *Handler) ProcessMessage(ctx context.Context, userID string, message string) (string, error) {
    user, err := h.userRepo.GetByID(ctx, userID)
    if err != nil {
        return "", fmt.Errorf("failed to get user: %w", err)
    }

    // Save user message
    userConv := &models.Conversation{
        ID:      uuid.New().String(),
        UserID:  user.LineID,
        Role:    models.RoleUser,
        Content: message,
    }
    if err := h.convRepo.Create(ctx, userConv); err != nil {
        return "", fmt.Errorf("failed to save user message: %w", err)
    }

    // Get conversation history
    history, err := h.convRepo.GetByUserID(ctx, user.LineID, 20)
    if err != nil {
        return "", fmt.Errorf("failed to get history: %w", err)
    }

    // Build prompt with history
    prompt := buildPrompt(history)

    // Call Gemini
    response, err := h.llm.PredictForText(ctx, prompt)
    if err != nil {
        return "", fmt.Errorf("failed to get LLM response: %w", err)
    }

    // Save assistant response
    assistantConv := &models.Conversation{
        ID:      uuid.New().String(),
        UserID:  user.LineID,
        Role:    models.RoleAssistant,
        Content: response,
    }
    if err := h.convRepo.Create(ctx, assistantConv); err != nil {
        return "", fmt.Errorf("failed to save assistant message: %w", err)
    }

    return response, nil
}

func buildPrompt(history []*models.Conversation) string {
    var prompt string
    for _, conv := range history {
        if conv.Role == models.RoleUser {
            prompt += fmt.Sprintf("User: %s\n", conv.Content)
        } else {
            prompt += fmt.Sprintf("Assistant: %s\n", conv.Content)
        }
    }
    return prompt
}
```

#### Step 5: LINE Bot ã‚µãƒ¼ãƒ“ã‚¹æ§‹ç¯‰ âœ…
**ä½œæ¥­å†…å®¹:**
- [x] `line_bot/cmd/main.go`ä½œæˆ
- [x] `line_bot/config/config.go`ä½œæˆ
- [x] `line_bot/middleware/signature.go`ä½œæˆï¼ˆLINEç½²åæ¤œè¨¼ï¼‰
- [x] `line_bot/routes/router.go`ä½œæˆ
- [x] `line_bot/routes/webhook.go`ä½œæˆ
- [x] `line_bot/logic/message.go`ä½œæˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- [x] `line_bot/logic/follow.go`ä½œæˆï¼ˆãƒ•ã‚©ãƒ­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼‰
- [x] `line_bot/Dockerfile`ä½œæˆ
- [x] `line_bot/.env.example`ä½œæˆ
- [x] `line_bot/README.md`ä½œæˆ

**å®Ÿè£…ãƒ¡ãƒ¢:**
- **Routes-Logicåˆ†é›¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: backendã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨
- **Logicå±¤**: æ–‡å­—åˆ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ï¼ˆé€ä¿¡ã¯routeså±¤ã§å‡¦ç†ï¼‰
- **Constructor-Level DI**: logic handlersã¯ä¾å­˜é–¢ä¿‚ã‚’å¼•æ•°ã§å—ã‘å–ã‚‹
- **Webhookå‡¦ç†**: 
  - MessageEvent: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†ã—ã¦Geminiå¿œç­”ã‚’è¿”ä¿¡
  - FollowEvent: æ–°è¦ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ã«LIFFç™»éŒ²æ¡ˆå†…ã‚’é€ä¿¡
- **LINEç½²åæ¤œè¨¼**: middlewareã§å®Ÿè£…ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¢ºä¿ï¼‰
- **Geminiçµ±åˆ**: gemini-2.5-flash-liteãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨

**line_bot/routes/webhook.go:**
```go
package routes

import (
    "net/http"
    "github.com/gin-gonic/gin"
    "github.com/line/line-bot-sdk-go/v8/linebot/messaging_api"
    "your-module/line_bot/logic/message"
)

func WebhookHandler(c *gin.Context) {
    events, ok := c.Get("line_events")
    if !ok {
        c.JSON(http.StatusBadRequest, gin.H{"error": "no events found"})
        return
    }

    handler := message.NewHandler()
    for _, event := range events.([]*messaging_api.Event) {
        if event.Type == messaging_api.EventType_MESSAGE {
            if messageEvent, ok := event.Message.(*messaging_api.TextMessageContent); ok {
                err := handler.HandleTextMessage(c.Request.Context(), event.Source.UserId, messageEvent.Text)
                if err != nil {
                    // Log error but continue processing
                    log.Error().Err(err).Msg("failed to handle message")
                }
            }
        }
    }

    c.JSON(http.StatusOK, gin.H{"status": "ok"})
}
```

**line_bot/logic/message/handler.go:**
```go
package message

import (
    "context"
    "fmt"
    "os"
    "github.com/google/uuid"
    "github.com/line/line-bot-sdk-go/v8/linebot/messaging_api"
    "your-module/go_pkg/llm"
    "your-module/go_pkg/models"
    "your-module/go_pkg/repository"
)

type Handler struct {
    convRepo  repository.ConversationRepo
    llm       llm.GoogleGemini
    lineBot   *messaging_api.MessagingApiAPI
}

func NewHandler() *Handler {
    ctx := context.Background()
    geminiClient, err := llm.NewGoogleGemini(
        ctx,
        os.Getenv("GEMINI_API_KEY"),
        "gemini-1.5-flash",
    )
    if err != nil {
        panic(fmt.Sprintf("failed to create gemini client: %v", err))
    }

    bot, err := messaging_api.NewMessagingApiAPI(os.Getenv("LINE_CHANNEL_TOKEN"))
    if err != nil {
        panic(fmt.Sprintf("failed to create line bot: %v", err))
    }

    return &Handler{
        convRepo: repository.NewConversationRepo(),
        llm:      geminiClient,
        lineBot:  bot,
    }
}

func (h *Handler) HandleTextMessage(ctx context.Context, lineUserID string, text string) error {
    // Save user message
    userConv := &models.Conversation{
        ID:      uuid.New().String(),
        UserID:  lineUserID,
        Role:    models.RoleUser,
        Content: text,
    }
    if err := h.convRepo.Create(ctx, userConv); err != nil {
        return fmt.Errorf("failed to save user message: %w", err)
    }

    // Get conversation history
    history, err := h.convRepo.GetByUserID(ctx, lineUserID, 20)
    if err != nil {
        return fmt.Errorf("failed to get history: %w", err)
    }

    // Build prompt
    prompt := buildPrompt(history)

    // Call Gemini
    response, err := h.llm.PredictForText(ctx, prompt)
    if err != nil {
        return fmt.Errorf("failed to get LLM response: %w", err)
    }

    // Save assistant response
    assistantConv := &models.Conversation{
        ID:      uuid.New().String(),
        UserID:  lineUserID,
        Role:    models.RoleAssistant,
        Content: response,
    }
    if err := h.convRepo.Create(ctx, assistantConv); err != nil {
        return fmt.Errorf("failed to save assistant message: %w", err)
    }

    // Send response via LINE
    _, err = h.lineBot.ReplyMessage(&messaging_api.ReplyMessageRequest{
        ReplyToken: replyToken,
        Messages: []messaging_api.MessageInterface{
            &messaging_api.TextMessage{
                Text: response,
            },
        },
    })
    if err != nil {
        return fmt.Errorf("failed to send LINE message: %w", err)
    }

    return nil
}

func buildPrompt(history []*models.Conversation) string {
    var prompt string
    for _, conv := range history {
        if conv.Role == models.RoleUser {
            prompt += fmt.Sprintf("User: %s\n", conv.Content)
        } else {
            prompt += fmt.Sprintf("Assistant: %s\n", conv.Content)
        }
    }
    return prompt
}
```

### 5.2 Phase 2: LIFF ã‚¢ãƒ—ãƒªæ§‹ç¯‰ï¼ˆStep 6-8ï¼‰ğŸš§ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º

#### Step 6: LIFF ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ– ğŸ“ æœªç€æ‰‹
**ä½œæ¥­å†…å®¹:**
- [ ] Next.js 15 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆï¼ˆApp Routerï¼‰
- [ ] å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
  - `@line/liff`
  - `@supabase/ssr`
  - `@supabase/supabase-js`
  - `shadcn/ui`
  - `tailwindcss`
  - `@radix-ui/react-*`ï¼ˆshadcn/ui dependenciesï¼‰
- [ ] `biome.json`è¨­å®šï¼ˆcookLabã‹ã‚‰å‚è€ƒï¼‰
- [ ] `tsconfig.json`è¨­å®š
- [ ] `next.config.mjs`è¨­å®š
- [ ] `.env.local.example`ä½œæˆ
- [ ] `tailwind.config.ts`è¨­å®š

**æ¨å¥¨æ‰‹é †:**
```bash
cd /Users/yongtae/Documents/personal/code/LineBot-liff-golang-nextjs-template
npx create-next-app@latest liff --typescript --tailwind --app --no-src-dir
cd liff
npm install @line/liff @supabase/ssr @supabase/supabase-js
npx shadcn@latest init
```

**package.jsonã‚¹ã‚¯ãƒªãƒ—ãƒˆ:**
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "format": "biome check --write .",
    "lint": "biome check .",
    "type-check": "tsc --noEmit"
  }
}
```

#### Step 7: LIFF èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£… ğŸ“ æœªç€æ‰‹
**ä½œæ¥­å†…å®¹:**
- [ ] `app/lib/liff/init.ts`ä½œæˆï¼ˆLIFFåˆæœŸåŒ–ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- [ ] `app/lib/supabase/client.ts`ä½œæˆï¼ˆSupabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
- [ ] `app/lib/supabase/server.ts`ä½œæˆï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ç”¨ï¼‰
- [ ] `app/lib/api/client.ts`ä½œæˆï¼ˆBackend APIå‘¼ã³å‡ºã—ï¼‰
- [ ] `middleware.ts`ä½œæˆï¼ˆèªè¨¼ãƒã‚§ãƒƒã‚¯ï¼‰
- [ ] `app/login/page.tsx`ä½œæˆï¼ˆãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼‰
- [ ] `app/api/auth/signin/route.ts`ä½œæˆï¼ˆSupabaseèªè¨¼APIï¼‰
- [ ] `components/providers/LiffProvider.tsx`ä½œæˆï¼ˆLIFF Contextï¼‰

**èªè¨¼ãƒ•ãƒ­ãƒ¼:**
1. LIFFåˆæœŸåŒ– â†’ LINE Access Tokenå–å¾—
2. Backend API `/api/v1/user/register`å‘¼ã³å‡ºã—
3. Supabase `signInWithPassword`ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºç«‹
4. `/chat`ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

**src/lib/liff/init.ts:**
```typescript
import liff from "@line/liff";

export const initializeLiff = async (): Promise<string> => {
  const liffId = process.env.NEXT_PUBLIC_LIFF_ID;
  if (!liffId) {
    throw new Error("LIFF ID is not defined");
  }

  try {
    await liff.init({ liffId });

    if (!liff.isLoggedIn()) {
      liff.login();
      throw new Error("Not logged in, redirecting...");
    }

    const accessToken = liff.getAccessToken();
    if (!accessToken) {
      throw new Error("Failed to get access token");
    }

    return accessToken;
  } catch (error) {
    console.error("LIFF initialization failed:", error);
    throw error;
  }
};

export const getLiffProfile = async () => {
  if (!liff.isLoggedIn()) {
    throw new Error("Not logged in");
  }
  return await liff.getProfile();
};
```

**src/app/login/page.tsx:**
```typescript
"use client";

import { useEffect, useState } from "react";
import { useRouter } from "next/navigation";
import { initializeLiff } from "@/lib/liff/init";

export default function LoginPage() {
  const router = useRouter();
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const login = async () => {
      try {
        const accessToken = await initializeLiff();

        // Call backend to register user
        const response = await fetch(
          `${process.env.NEXT_PUBLIC_BACKEND_URL}/api/v1/user/register`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ access_token: accessToken }),
          }
        );

        if (!response.ok) {
          throw new Error("Failed to register user");
        }

        const { line_id } = await response.json();

        // Sign in to Supabase
        const supabaseResponse = await fetch("/api/auth/signin", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ line_id }),
        });

        if (!supabaseResponse.ok) {
          throw new Error("Failed to sign in to Supabase");
        }

        router.push("/chat");
      } catch (err) {
        setError(err instanceof Error ? err.message : "Unknown error");
      }
    };

    login();
  }, [router]);

  if (error) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-red-500">Error: {error}</div>
      </div>
    );
  }

  return (
    <div className="flex items-center justify-center min-h-screen">
      <div>Logging in...</div>
    </div>
  );
}
```

#### Step 8: ãƒãƒ£ãƒƒãƒˆUIå®Ÿè£… ğŸ“ æœªç€æ‰‹
**ä½œæ¥­å†…å®¹:**
- [ ] `types/conversation.ts`ä½œæˆï¼ˆå‹å®šç¾©ï¼‰
- [ ] `components/chat/ChatContainer.tsx`ä½œæˆï¼ˆãƒãƒ£ãƒƒãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
- [ ] `components/chat/MessageBubble.tsx`ä½œæˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼‰
- [ ] `components/chat/MessageList.tsx`ä½œæˆï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒˆï¼‰
- [ ] `components/chat/InputBar.tsx`ä½œæˆï¼ˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼‰
- [ ] `app/(authenticated)/chat/page.tsx`ä½œæˆï¼ˆãƒãƒ£ãƒƒãƒˆç”»é¢ï¼‰
- [ ] `app/(authenticated)/layout.tsx`ä½œæˆï¼ˆèªè¨¼æ¸ˆã¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
- [ ] shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå°å…¥
  - `Button`
  - `Input`
  - `ScrollArea`
  - `Card`
  - `Avatar`

**å®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ:**
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆSupabase Realtimeä½¿ç”¨ï¼‰
- ã‚ªãƒ—ãƒ†ã‚£ãƒŸã‚¹ãƒ†ã‚£ãƒƒã‚¯UIæ›´æ–°
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ä¸­ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
- è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆæœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¸ï¼‰

**src/types/conversation.ts:**
```typescript
export type Role = "user" | "assistant";

export interface Conversation {
  id: string;
  user_id: string;
  role: Role;
  content: string;
  created_at: string;
}
```

**src/lib/api/client.ts:**
```typescript
import { createClient } from "@/lib/supabase/client";
import type { Conversation } from "@/types/conversation";

export class ApiClient {
  private baseUrl: string;

  constructor() {
    this.baseUrl = process.env.NEXT_PUBLIC_BACKEND_URL || "";
  }

  private async getAuthHeader(): Promise<string> {
    const supabase = createClient();
    const {
      data: { session },
    } = await supabase.auth.getSession();

    if (!session?.access_token) {
      throw new Error("No access token");
    }

    return `Bearer ${session.access_token}`;
  }

  async getConversations(limit = 50): Promise<Conversation[]> {
    const authHeader = await this.getAuthHeader();

    const response = await fetch(
      `${this.baseUrl}/api/v1/conversations?limit=${limit}`,
      {
        headers: {
          Authorization: authHeader,
        },
      }
    );

    if (!response.ok) {
      throw new Error("Failed to fetch conversations");
    }

    return response.json();
  }

  async sendMessage(message: string): Promise<{ response: string }> {
    const authHeader = await this.getAuthHeader();

    const response = await fetch(`${this.baseUrl}/api/v1/conversations`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: authHeader,
      },
      body: JSON.stringify({ message }),
    });

    if (!response.ok) {
      throw new Error("Failed to send message");
    }

    return response.json();
  }
}

export const apiClient = new ApiClient();
```

**src/app/(authenticated)/chat/page.tsx:**
```typescript
"use client";

import { useEffect, useState } from "react";
import { ChatContainer } from "@/components/chat/ChatContainer";
import { MessageBubble } from "@/components/chat/MessageBubble";
import { InputBar } from "@/components/chat/InputBar";
import { apiClient } from "@/lib/api/client";
import type { Conversation } from "@/types/conversation";

export default function ChatPage() {
  const [conversations, setConversations] = useState<Conversation[]>([]);
  const [loading, setLoading] = useState(true);
  const [sending, setSending] = useState(false);

  useEffect(() => {
    const loadConversations = async () => {
      try {
        const data = await apiClient.getConversations();
        setConversations(data);
      } catch (error) {
        console.error("Failed to load conversations:", error);
      } finally {
        setLoading(false);
      }
    };

    loadConversations();
  }, []);

  const handleSendMessage = async (message: string) => {
    setSending(true);
    try {
      const response = await apiClient.sendMessage(message);

      // Add user message
      setConversations((prev) => [
        ...prev,
        {
          id: crypto.randomUUID(),
          user_id: "",
          role: "user",
          content: message,
          created_at: new Date().toISOString(),
        },
      ]);

      // Add assistant response
      setConversations((prev) => [
        ...prev,
        {
          id: crypto.randomUUID(),
          user_id: "",
          role: "assistant",
          content: response.response,
          created_at: new Date().toISOString(),
        },
      ]);
    } catch (error) {
      console.error("Failed to send message:", error);
    } finally {
      setSending(false);
    }
  };

  if (loading) {
    return <div>Loading...</div>;
  }

  return (
    <ChatContainer>
      <div className="flex flex-col h-full">
        <div className="flex-1 overflow-y-auto p-4 space-y-4">
          {conversations.map((conv) => (
            <MessageBubble
              key={conv.id}
              role={conv.role}
              content={conv.content}
              timestamp={conv.created_at}
            />
          ))}
        </div>
        <InputBar onSend={handleSendMessage} disabled={sending} />
      </div>
    </ChatContainer>
  );
}
```

### 5.3 Phase 3: ã‚¤ãƒ³ãƒ•ãƒ©ã¨CI/CDï¼ˆStep 9-11ï¼‰â³ å¾Œç¶šãƒ•ã‚§ãƒ¼ã‚º

#### Step 9: DockeråŒ– ğŸ“ æœªç€æ‰‹
**ä½œæ¥­å†…å®¹:**
- [x] `backend/Dockerfile`ä½œæˆæ¸ˆã¿ï¼ˆãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ï¼‰
- [x] `line_bot/Dockerfile`ä½œæˆæ¸ˆã¿ï¼ˆãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ï¼‰
- [ ] `.dockerignore`ä½œæˆï¼ˆãƒ«ãƒ¼ãƒˆï¼‰
- [ ] `docker-compose.yml`ä½œæˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨ï¼‰
- [ ] Cloud Runç”¨ã®æœ€é©åŒ–è¨­å®š

**æ¨å¥¨Dockeræ§‹æˆ:**
- ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ï¼ˆå°ã•ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºï¼‰
- érootãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®å®Ÿè¡Œ
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨

#### Step 10: CI/CDè¨­å®š ğŸ“ æœªç€æ‰‹
**ä½œæ¥­å†…å®¹:**
- [ ] `.github/workflows/test.yml`ä½œæˆï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰
- [ ] `.github/workflows/backend-deploy.yml`ä½œæˆï¼ˆCloud Runãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
- [ ] `.github/workflows/line-bot-deploy.yml`ä½œæˆï¼ˆCloud Runãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
- [ ] `.github/workflows/liff-deploy.yml`ä½œæˆï¼ˆCloudflare Pagesãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
- [ ] GitHub Secretsã®è¨­å®šæ‰‹é †ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–

**å¯¾è±¡ç’°å¢ƒ:**
- Developmentï¼ˆdevelopãƒ–ãƒ©ãƒ³ãƒï¼‰
- Productionï¼ˆmainãƒ–ãƒ©ãƒ³ãƒã€manual approvalï¼‰

**ãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹:**
```yaml
name: Test

on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main, develop]

jobs:
  test-go:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24.2'

      - name: Install dependencies
        run: |
          cd go_pkg && go mod download
          cd ../backend && go mod download
          cd ../line_bot && go mod download

      - name: Run tests
        run: |
          cd go_pkg && go test ./...
          cd ../backend && go test ./...
          cd ../line_bot && go test ./...

  test-liff:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        working-directory: ./liff
        run: npm ci

      - name: Lint
        working-directory: ./liff
        run: npm run lint

      - name: Type check
        working-directory: ./liff
        run: npm run type-check
```

#### Step 11: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ ğŸš§ ä¸€éƒ¨å®Œäº†
**ä½œæ¥­å†…å®¹:**
- [x] `README.md`ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ä½œæˆæ¸ˆã¿ - Quick Starté‡è¦–
- [x] `supabase/README.md`ä½œæˆæ¸ˆã¿ - è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
- [x] `backend/README.md`ä½œæˆæ¸ˆã¿
- [x] `line_bot/README.md`ä½œæˆæ¸ˆã¿
- [x] `go_pkg/README.md`ä½œæˆæ¸ˆã¿
- [ ] `docs/ARCHITECTURE.md`ä½œæˆï¼ˆã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°ï¼‰
- [ ] `docs/DEVELOPMENT.md`ä½œæˆï¼ˆé–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰ï¼‰
- [ ] `docs/DEPLOYMENT.md`ä½œæˆï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼‰
- [ ] `docs/API.md`ä½œæˆï¼ˆAPIä»•æ§˜æ›¸ï¼‰
- [ ] `liff/README.md`ä½œæˆï¼ˆLIFFã‚¢ãƒ—ãƒªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ‡ãƒ¢ãƒ“ãƒ‡ã‚ªã®ä½œæˆ

**å„ªå…ˆåº¦:**
1. å‹•ä½œã™ã‚‹LIFFã‚¢ãƒ—ãƒªã®å®Œæˆ
2. ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–
3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
4. ãƒ‡ãƒ¢ç´ æã®ä½œæˆ

---

## 6. èªè¨¼ãƒ•ãƒ­ãƒ¼

### 6.1 åˆå›ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ï¼ˆLIFFçµŒç”±ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Opens LIFF in LINE
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LIFF App      â”‚
â”‚  (Next.js)      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. liff.init()
     â”‚ 3. liff.getAccessToken()
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/v1/user/register         â”‚
â”‚  Body: { access_token: "..." }      â”‚
â”‚                                     â”‚
â”‚  Backend API Service                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 4. Verify LINE token with LINE API
     â”‚ 5. Get LINE user profile
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase                           â”‚
â”‚                                     â”‚
â”‚  - Check if user exists             â”‚
â”‚    (by line_id)                     â”‚
â”‚  - If not, create auth user         â”‚
â”‚  - Create/update users table record â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 6. Return line_id to LIFF
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LIFF App      â”‚
â”‚                 â”‚
â”‚ 7. Sign in with â”‚
â”‚    Supabase     â”‚
â”‚    email/pass   â”‚
â”‚    (generated)  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 8. Store session cookie
     â”‚ 9. Redirect to /chat
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Page      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 èªè¨¼æ¸ˆã¿APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LIFF App    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1. Get Supabase session token
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/v1/conversations          â”‚
â”‚  Header: Authorization: Bearer XXX  â”‚
â”‚                                     â”‚
â”‚  Backend API Service                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Extract JWT from header
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auth Middleware                    â”‚
â”‚                                     â”‚
â”‚  - Validate JWT signature           â”‚
â”‚    (using SUPABASE_JWT_SECRET)      â”‚
â”‚  - Extract user_id from claims      â”‚
â”‚  - Set user_id in context           â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. user_id available in handler
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Route Handler                      â”‚
â”‚                                     â”‚
â”‚  - Get user_id from context         â”‚
â”‚  - Query Supabase                   â”‚
â”‚  - Return data                      â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 LINE Botã‹ã‚‰ã®ä¼šè©±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 1. Sends message via LINE
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LINE Platform   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 2. Webhook POST
     â”‚    /webhook
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LINE Bot Service                   â”‚
â”‚                                     â”‚
â”‚  - Verify LINE signature            â”‚
â”‚  - Extract LINE User ID             â”‚
â”‚  - Process message                  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚ 3. Query/Save to Supabase
     â”‚    (using LINE User ID directly)
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Supabase                           â”‚
â”‚                                     â”‚
â”‚  conversations table                â”‚
â”‚  user_id = LINE User ID             â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡è¦ãªè¨­è¨ˆæ±ºå®š:**
- LINE User IDã‚’`conversations.user_id`ã¨ã—ã¦ä½¿ç”¨ï¼ˆèªè¨¼ä¸è¦ã§è­˜åˆ¥å¯èƒ½ï¼‰
- LIFF Appã¯Supabaseèªè¨¼ã‚’é€šã˜ã¦ã€`users`ãƒ†ãƒ¼ãƒ–ãƒ«ã§è‡ªåˆ†ã®`line_id`ã‚’å–å¾—
- Backend APIã¯`user_id` (Supabase UUID) â†’ `line_id` (LINE User ID) ã®å¤‰æ›ã‚’è¡Œã†

---

## 7. ä¼šè©±åŒæœŸã®ä»•çµ„ã¿

### 7.1 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®çµ±ä¸€

**Key Point: LINE User IDã‚’å…±é€šè­˜åˆ¥å­ã¨ã—ã¦ä½¿ç”¨**

```sql
-- conversations ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE conversations (
  id UUID PRIMARY KEY,
  user_id TEXT NOT NULL,  -- LINE User ID (å…±é€šè­˜åˆ¥å­)
  role TEXT NOT NULL,
  content TEXT NOT NULL,
  created_at TIMESTAMPTZ
);

-- users ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
  id UUID PRIMARY KEY,                    -- Supabase Auth UUID
  line_id TEXT UNIQUE NOT NULL,           -- LINE User ID
  name TEXT,
  created_at TIMESTAMPTZ,
  updated_at TIMESTAMPTZ
);
```

### 7.2 åŒæœŸã®ãƒ­ã‚¸ãƒƒã‚¯

#### LINE Bot Service
```go
// LINE Webhookã‹ã‚‰LINE User IDã‚’ç›´æ¥å–å¾—
lineUserID := event.Source.UserId

// conversationsãƒ†ãƒ¼ãƒ–ãƒ«ã«ç›´æ¥ä¿å­˜
conversation := &models.Conversation{
    UserID: lineUserID,  // LINE User ID
    Role: "user",
    Content: message,
}
repo.Create(ctx, conversation)
```

#### Backend API Service
```go
// Supabase JWTã‹ã‚‰Supabase UUIDã‚’å–å¾—
supabaseUserID := c.Get("user_id")  // from JWT claims

// usersãƒ†ãƒ¼ãƒ–ãƒ«ã§LINE User IDã‚’å–å¾—
user, err := userRepo.GetByID(ctx, supabaseUserID)
lineUserID := user.LineID

// conversationsãƒ†ãƒ¼ãƒ–ãƒ«ã‚’LINE User IDã§ã‚¯ã‚¨ãƒª
conversations, err := convRepo.GetByUserID(ctx, lineUserID, limit)
```

### 7.3 åŒæœŸä¿è¨¼ã®ä»•çµ„ã¿

**ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯ä¸è¦** (åˆ¥ã€…ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰æ›¸ãè¾¼ã¾ã‚Œã‚‹ãŸã‚)

**æ•´åˆæ€§ã®ä¿è¨¼:**
1. **ä¸€æ„æ€§**: LINE User IDã¯ä¸€æ„ã§ã‚ã‚‹ã“ã¨ãŒLINEãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ä¿è¨¼
2. **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: `created_at`ã§æ™‚ç³»åˆ—é †ã«å–å¾—å¯èƒ½
3. **å†ªç­‰æ€§**: åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¤‡æ•°å›ä¿å­˜ã—ã¦ã‚‚å•é¡Œãªã„ï¼ˆUUIDã§è­˜åˆ¥ï¼‰

**ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰:**
- Supabase Realtimeã‚’ä½¿ç”¨ã—ã¦LIFF Appã§ä¼šè©±ã‚’è‡ªå‹•æ›´æ–°
- LINE BotçµŒç”±ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒLIFF Appã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ 

```typescript
// LIFF App
useEffect(() => {
  const supabase = createClient();
  
  const subscription = supabase
    .channel('conversations')
    .on(
      'postgres_changes',
      {
        event: 'INSERT',
        schema: 'public',
        table: 'conversations',
        filter: `user_id=eq.${lineUserID}`,
      },
      (payload) => {
        setConversations((prev) => [...prev, payload.new]);
      }
    )
    .subscribe();

  return () => {
    subscription.unsubscribe();
  };
}, [lineUserID]);
```

---

## 8. é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 8.1 å¿…è¦ãªãƒ„ãƒ¼ãƒ«

| ãƒ„ãƒ¼ãƒ« | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³• |
|--------|-----------|---------------|
| **Go** | 1.24.2 | https://go.dev/dl/ |
| **Node.js** | 20.x | https://nodejs.org/ |
| **npm/yarn** | latest | Node.jsã«åŒæ¢± |
| **Docker** | latest | https://www.docker.com/ |
| **Supabase CLI** | latest | `npm install -g supabase` |
| **Mage** | latest | `go install github.com/magefile/mage@latest` |
| **gcloud CLI** | latest | https://cloud.google.com/sdk/docs/install |

### 8.2 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒæ§‹ç¯‰æ‰‹é †

#### Step 1: ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
```bash
git clone https://github.com/YOUR_ORG/LineBot-liff-golang-nextjs-template.git
cd LineBot-liff-golang-nextjs-template
```

#### Step 2: Supabaseãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒèµ·å‹•
```bash
cd supabase
supabase start
```

Supabaseã®æ¥ç¶šæƒ…å ±ã‚’è¨˜éŒ²:
```
API URL: http://localhost:54321
anon key: eyJh...
service_role key: eyJh...
JWT secret: super-secret-jwt-token-with-at-least-32-characters-long
```

#### Step 3: ç’°å¢ƒå¤‰æ•°è¨­å®š

**backend/.env:**
```bash
ENV=local
SUPABASE_URL=http://localhost:54321
SUPABASE_KEY=eyJh... (service_role key)
SUPABASE_JWT_SECRET=super-secret-jwt-token-with-at-least-32-characters-long
GEMINI_API_KEY=your-gemini-api-key
PORT=8080
```

**line_bot/.env:**
```bash
ENV=local
SUPABASE_URL=http://localhost:54321
SUPABASE_KEY=eyJh... (service_role key)
GEMINI_API_KEY=your-gemini-api-key
LINE_CHANNEL_SECRET=your-line-channel-secret
LINE_CHANNEL_TOKEN=your-line-channel-token
PORT=8000
```

**liff/.env.local:**
```bash
NEXT_PUBLIC_LIFF_ID=your-liff-id
NEXT_PUBLIC_BACKEND_URL=http://localhost:8080
NEXT_PUBLIC_SUPABASE_URL=http://localhost:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJh... (anon key)
COMMON_PASSWORD_PREFIX=your-common-password-prefix
```

#### Step 4: Goä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# Workspace sync
go work sync

# å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
cd go_pkg && go mod download && cd ..
cd backend && go mod download && cd ..
cd line_bot && go mod download && cd ..
```

#### Step 5: LIFFä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
cd liff
npm install
```

#### Step 6: ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•

**Terminal 1: Backend API**
```bash
cd backend
go run mage.go run
# or: ENV=local go run cmd/main.go
```

**Terminal 2: LINE Bot**
```bash
cd line_bot
go run mage.go run
# or: ENV=local go run cmd/main.go
```

**Terminal 3: LIFF App**
```bash
cd liff
npm run dev
```

### 8.3 é–‹ç™ºã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

#### Go (backend, line_bot, go_pkgå…±é€š)
```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
go run mage.go test

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
go run mage.go fmt

# ãƒªãƒ³ãƒˆ
go run mage.go lint

# ãƒ¢ãƒƒã‚¯ç”Ÿæˆ
go run mage.go generate

# ä¾å­˜é–¢ä¿‚æ›´æ–°
go run mage.go update
```

#### LIFF
```bash
# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ãƒ“ãƒ«ãƒ‰
npm run build

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
npm run format

# ãƒªãƒ³ãƒˆ
npm run lint

# å‹ãƒã‚§ãƒƒã‚¯
npm run type-check

# Supabaseå‹å®šç¾©ç”Ÿæˆ
npm run gen:types
```

#### Supabase
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒèµ·å‹•
supabase start

# ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒåœæ­¢
supabase stop

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
supabase migration new <migration_name>

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
supabase db reset

# å‹å®šç¾©ç”Ÿæˆ
supabase gen types typescript --local > liff/src/types/supabase.ts
```

---

## 9. ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

### 9.1 ç’°å¢ƒæ§‹æˆ

| ç’°å¢ƒ | èª¬æ˜ | ãƒ–ãƒ©ãƒ³ãƒ | è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ |
|------|------|---------|------------|
| **Local** | é–‹ç™ºç’°å¢ƒ | - | - |
| **Development** | é–‹ç™ºçµ±åˆç’°å¢ƒ | `develop` | âœ… |
| **Staging** | ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ | `staging` | âœ… |
| **Production** | æœ¬ç•ªç’°å¢ƒ | `main` | âœ… (manual approval) |

### 9.2 å„ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ

#### Backend API & LINE Bot
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Google Cloud Run
- **ç†ç”±**: 
  - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ï¼ˆä½¿ç”¨é‡èª²é‡‘ï¼‰
  - è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
  - Dockerã‚¤ãƒ¡ãƒ¼ã‚¸å¯¾å¿œ
  - LINE Webhookã«é©ã—ã¦ã„ã‚‹

**ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆGitHub Actionsï¼‰:**
```yaml
- name: Deploy to Cloud Run
  run: |
    gcloud run deploy ${{ env.SERVICE_NAME }} \
      --image gcr.io/${{ env.GCP_PROJECT }}/${{ env.SERVICE_NAME }}:${{ github.sha }} \
      --platform managed \
      --region asia-northeast1 \
      --allow-unauthenticated \
      --set-env-vars ENV=${{ env.ENV }} \
      --set-secrets SUPABASE_URL=supabase-url:latest,SUPABASE_KEY=supabase-key:latest
```

#### LIFF App
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Cloudflare Pages
- **ç†ç”±**:
  - ç„¡æ–™æ ãŒå¤§ãã„
  - ã‚°ãƒ­ãƒ¼ãƒãƒ«CDN
  - Next.js App Routerå¯¾å¿œï¼ˆOpenNextï¼‰
  - é«˜é€Ÿ

**ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ï¼ˆGitHub Actionsï¼‰:**
```yaml
- name: Deploy to Cloudflare Pages
  uses: cloudflare/pages-action@v1
  with:
    apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
    accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
    projectName: linebot-liff-template
    directory: .vercel/output/static
```

#### Supabase
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Supabase Cloud
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†**: Supabase CLI + GitHub Actions

**ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œ:**
```yaml
- name: Run migrations
  run: |
    supabase link --project-ref ${{ secrets.SUPABASE_PROJECT_REF }}
    supabase db push
```

### 9.3 ç’°å¢ƒå¤‰æ•°ç®¡ç†

#### GitHub Secretsï¼ˆæœ¬ç•ªï¼‰
```
GCP_PROJECT_ID
GCP_SA_KEY
CLOUDFLARE_API_TOKEN
CLOUDFLARE_ACCOUNT_ID
SUPABASE_PROJECT_REF
SUPABASE_ACCESS_TOKEN
```

#### Cloud Secrets Managerï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼‰
Backend & LINE Bot ã§ä½¿ç”¨:
- `SUPABASE_URL`
- `SUPABASE_KEY`
- `SUPABASE_JWT_SECRET`
- `GEMINI_API_KEY`
- `LINE_CHANNEL_SECRET`
- `LINE_CHANNEL_TOKEN`

#### Cloudflare Environment Variablesï¼ˆLIFFï¼‰
- `NEXT_PUBLIC_LIFF_ID`
- `NEXT_PUBLIC_BACKEND_URL`
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `COMMON_PASSWORD_PREFIX`

---

## 10. READMEæ§‹æˆ

### 10.1 ãƒ¡ã‚¤ãƒ³README.mdæ§‹æˆ

```markdown
# LINE Bot + LIFF + Golang + Next.js Template

[é­…åŠ›çš„ãªãƒ˜ãƒƒãƒ€ãƒ¼ç”»åƒ]

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Go Version](https://img.shields.io/badge/Go-1.24.2-blue.svg)](https://go.dev/)
[![Next.js Version](https://img.shields.io/badge/Next.js-15.x-black.svg)](https://nextjs.org/)

## ğŸŒŸ Overview

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€LINE Botã¨LIFFã‚’ä½¿ç”¨ã—ã¦Gemini LLMã¨ä¼šè©±ã§ãã‚‹
ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚
LINE Botã§ã®ä¼šè©±ã¨LIFFã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã§ã®ä¼šè©±ãŒå®Œå…¨ã«åŒæœŸã•ã‚Œã¾ã™ã€‚

### âœ¨ Features

- ğŸ¤– **LINE Botçµ±åˆ**: LINE Messaging APIã‚’ä½¿ã£ãŸè‡ªç„¶ãªä¼šè©±
- ğŸŒ **LIFF Web App**: Next.jsè£½ã®ãƒ¢ãƒ€ãƒ³ãªãƒãƒ£ãƒƒãƒˆUI
- ğŸ§  **Gemini LLM**: Google Geminiã‚’ä½¿ã£ãŸé«˜åº¦ãªä¼šè©±æ©Ÿèƒ½
- ğŸ”„ **ä¼šè©±åŒæœŸ**: LINE Botã¨LIFFã§ä¼šè©±å±¥æ­´ã‚’å®Œå…¨å…±æœ‰
- ğŸ” **å …ç‰¢ãªèªè¨¼**: LINEèªè¨¼ã¨Supabaseèªè¨¼ã®çµ±åˆ
- ğŸš€ **æœ¬ç•ªç’°å¢ƒå¯¾å¿œ**: Dockerã€Cloud Runã€Cloudflareå¯¾å¿œ
- ğŸ“¦ **ãƒ¢ãƒãƒ¬ãƒæ§‹æˆ**: Go Workspaceã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªé–‹ç™º
- ğŸ§ª **ãƒ†ã‚¹ãƒˆå®Œå‚™**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ãƒ¢ãƒƒã‚¯ã®å®Œå…¨ã‚µãƒãƒ¼ãƒˆ

### ğŸ—ï¸ Architecture

[ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³]

### ğŸ“¸ Screenshots

[LINE Bot]    [LIFF App]    [ä¼šè©±åŒæœŸã®ãƒ‡ãƒ¢]

## ğŸš€ Quick Start

### Prerequisites

- Go 1.24.2+
- Node.js 20+
- Docker
- Supabase CLI
- LINE Developers Account
- Google Cloud Account (for Gemini API)

### 1. Clone Repository

\```bash
git clone https://github.com/YOUR_ORG/LineBot-liff-golang-nextjs-template.git
cd LineBot-liff-golang-nextjs-template
\```

### 2. Setup Supabase

\```bash
cd supabase
supabase start
\```

### 3. Configure Environment Variables

Copy example files and fill in your credentials:

\```bash
cp backend/.env.example backend/.env
cp line_bot/.env.example line_bot/.env
cp liff/.env.local.example liff/.env.local
\```

### 4. Install Dependencies

\```bash
# Go
go work sync
cd go_pkg && go mod download && cd ..
cd backend && go mod download && cd ..
cd line_bot && go mod download && cd ..

# LIFF
cd liff && npm install
\```

### 5. Run Services

\```bash
# Terminal 1: Backend API
cd backend && go run mage.go run

# Terminal 2: LINE Bot
cd line_bot && go run mage.go run

# Terminal 3: LIFF App
cd liff && npm run dev
\```

## ğŸ“š Documentation

- [Architecture](docs/ARCHITECTURE.md) - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®è©³ç´°
- [Development Guide](docs/DEVELOPMENT.md) - é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰
- [Deployment Guide](docs/DEPLOYMENT.md) - ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
- [API Reference](docs/API.md) - APIä»•æ§˜æ›¸

## ğŸ› ï¸ Development

### Common Commands

\```bash
# Test
go run mage.go test     # Go tests
npm run test            # LIFF tests

# Format
go run mage.go fmt      # Go format
npm run format          # LIFF format

# Lint
go run mage.go lint     # Go lint
npm run lint            # LIFF lint
\```

### Project Structure

\```
â”œâ”€â”€ go_pkg/        # Shared Go packages
â”œâ”€â”€ backend/       # Backend API service
â”œâ”€â”€ line_bot/      # LINE Bot service
â”œâ”€â”€ liff/          # LIFF App (Next.js)
â”œâ”€â”€ supabase/      # Database migrations
â””â”€â”€ docs/          # Documentation
\```

## ğŸŒ Deployment

### Backend & LINE Bot

Deployed to **Google Cloud Run**

\```bash
# Deploy to development
git push origin develop

# Deploy to production
git push origin main
\```

### LIFF App

Deployed to **Cloudflare Pages**

\```bash
cd liff
npm run deploy
\```

See [Deployment Guide](docs/DEPLOYMENT.md) for details.

## ğŸ¤ Contributing

Contributions are welcome! Please read our [Contributing Guide](CONTRIBUTING.md).

## ğŸ“ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file.

## ğŸ™ Acknowledgments

- [LINE Messaging API](https://developers.line.biz/ja/services/messaging-api/)
- [LIFF (LINE Front-end Framework)](https://developers.line.biz/ja/docs/liff/)
- [Google Gemini](https://ai.google.dev/)
- [Supabase](https://supabase.com/)
- [Next.js](https://nextjs.org/)
- [Gin](https://gin-gonic.com/)

## ğŸ“§ Contact

- Issues: [GitHub Issues](https://github.com/YOUR_ORG/LineBot-liff-golang-nextjs-template/issues)
- Discussions: [GitHub Discussions](https://github.com/YOUR_ORG/LineBot-liff-golang-nextjs-template/discussions)

---

Made with â¤ï¸ for the LINE Bot community
```

### 10.2 å„ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®README

#### go_pkg/README.md
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ¦‚è¦
- å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®èª¬æ˜ï¼ˆmodels, repository, llm, mageï¼‰
- ä½¿ç”¨æ–¹æ³•ã¨ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰
- ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹
- ãƒ¢ãƒƒã‚¯ç”Ÿæˆæ–¹æ³•

#### backend/README.md
- ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§
- ç’°å¢ƒå¤‰æ•°èª¬æ˜
- ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œæ–¹æ³•
- ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

#### line_bot/README.md
- ã‚µãƒ¼ãƒ“ã‚¹ã®æ¦‚è¦
- Webhookè¨­å®šæ–¹æ³•
- ç’°å¢ƒå¤‰æ•°èª¬æ˜
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆngrokä½¿ç”¨ï¼‰
- ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

#### liff/README.md
- ã‚¢ãƒ—ãƒªæ¦‚è¦
- LIFFè¨­å®šæ–¹æ³•
- ç’°å¢ƒå¤‰æ•°èª¬æ˜
- é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ–¹æ³•
- ãƒ“ãƒ«ãƒ‰ã¨ãƒ‡ãƒ—ãƒ­ã‚¤

#### supabase/README.md
- ã‚¹ã‚­ãƒ¼ãƒæ¦‚è¦
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ–¹æ³•
- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒæ§‹ç¯‰
- RLSè¨­å®šèª¬æ˜

---

## 11. å®Ÿè£…ã®å„ªå…ˆé †ä½ã¨ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³

### Milestone 1: åŸºç›¤æ§‹ç¯‰ âœ… å®Œäº†
- âœ… Go Workspaceè¨­å®š
- âœ… go_pkgå®Ÿè£…ï¼ˆmodels, repository, llm, mageï¼‰
- âœ… Supabaseã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆï¼ˆGUI + Migrationï¼‰
- âœ… Backend APIåŸºæœ¬å®Ÿè£…
- ğŸ¯ ã‚´ãƒ¼ãƒ«: Backend APIã§Geminiã¨ä¼šè©±ã§ãã‚‹ã“ã¨ â†’ **é”æˆ**

**å®Ÿè£…å†…å®¹:**
- Method-Level DI ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- LINE Access Tokenæ¤œè¨¼
- Gemini 2.5 Flash Liteçµ±åˆ
- Supabase Auth Admin APIçµ±åˆ

### Milestone 2: LINE Botçµ±åˆ âœ… å®Œäº†
- âœ… LINE Bot Serviceå®Ÿè£…
- âœ… Webhookå‡¦ç†ï¼ˆMessage, Follow Eventsï¼‰
- âœ… LINEç½²åæ¤œè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
- âœ… ä¼šè©±ã®Supabaseä¿å­˜
- âœ… Routes-Logicåˆ†é›¢ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- ğŸ¯ ã‚´ãƒ¼ãƒ«: LINE Botã§Geminiã¨ä¼šè©±ã§ãã‚‹ã“ã¨ â†’ **é”æˆ**

**å®Ÿè£…å†…å®¹:**
- Constructor-Level DI for logic handlers
- LIFFç™»éŒ²æ¡ˆå†…ã®è‡ªå‹•é€ä¿¡
- Gemini 2.5 Flash Liteçµ±åˆ

### Milestone 3: LIFF Appå®Ÿè£… ğŸš§ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º
- [ ] Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- [ ] LIFFèªè¨¼ãƒ•ãƒ­ãƒ¼
- [ ] Supabaseèªè¨¼çµ±åˆ
- [ ] ãƒãƒ£ãƒƒãƒˆUIå®Ÿè£…
- ğŸ¯ ã‚´ãƒ¼ãƒ«: LIFF Appã§Geminiã¨ä¼šè©±ã§ãã‚‹ã“ã¨

**æ¨å®šä½œæ¥­æ™‚é–“:** 2-3æ—¥

### Milestone 4: ä¼šè©±åŒæœŸ â³ ä¿ç•™
- âœ… ä¼šè©±ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«çµ±ä¸€ï¼ˆå®Œäº†ï¼‰
- [ ] LINE Bot â†” LIFF App åŒæœŸç¢ºèª
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- ğŸ¯ ã‚´ãƒ¼ãƒ«: LINE Botã¨LIFFã§ä¼šè©±ãŒå®Œå…¨åŒæœŸã™ã‚‹ã“ã¨

**å‰ææ¡ä»¶:** Milestone 3å®Œäº†

### Milestone 5: ã‚¤ãƒ³ãƒ•ãƒ©ã¨CI/CD â³ ä¿ç•™
- âœ… DockeråŒ–ï¼ˆbackend, line_botï¼‰
- [ ] docker-compose.ymlä½œæˆ
- [ ] GitHub Actionsè¨­å®š
- [ ] Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
- [ ] Cloudflare Pagesãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
- ğŸ¯ ã‚´ãƒ¼ãƒ«: æœ¬ç•ªç’°å¢ƒã§å‹•ä½œã™ã‚‹ã“ã¨

**æ¨å®šä½œæ¥­æ™‚é–“:** 1-2æ—¥

### Milestone 6: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ä»•ä¸Šã’ ğŸš§ ä¸€éƒ¨å®Œäº†
- âœ… READMEä½œæˆï¼ˆQuick Starté‡è¦–ï¼‰
- âœ… ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªREADMEä½œæˆ
- [ ] è©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆï¼ˆdocs/ï¼‰
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä½œæˆ
- [ ] ãƒ‡ãƒ¢ãƒ“ãƒ‡ã‚ªä½œæˆ
- ğŸ¯ ã‚´ãƒ¼ãƒ«: èª°ã§ã‚‚ä½¿ãˆã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦å…¬é–‹

**æ¨å®šä½œæ¥­æ™‚é–“:** 2-3æ—¥

---

## ç¾åœ¨ã®çŠ¶æ…‹ã¨æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### âœ… å®Œäº†ã—ãŸä½œæ¥­
1. **Go Backendï¼ˆbackend, line_bot, go_pkgï¼‰** - å®Œå…¨å®Ÿè£…æ¸ˆã¿
2. **Supabaseã‚¹ã‚­ãƒ¼ãƒ** - åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Œæˆ
3. **èªè¨¼ãƒ•ãƒ­ãƒ¼è¨­è¨ˆ** - LINE â†’ Backend â†’ Supabase
4. **åŸºæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** - READMEç¾¤å®Œæˆ

### ğŸ¯ æ¬¡ã®å„ªå…ˆã‚¿ã‚¹ã‚¯ï¼ˆPhase 2ï¼‰
1. **LIFF ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–**ï¼ˆStep 6ï¼‰
   - Next.js 15ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
   - åŸºæœ¬è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

2. **LIFF èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…**ï¼ˆStep 7ï¼‰
   - LIFF SDKçµ±åˆ
   - Backend APIé€£æº
   - Supabaseèªè¨¼

3. **ãƒãƒ£ãƒƒãƒˆUIå®Ÿè£…**ï¼ˆStep 8ï¼‰
   - shadcn/uiå°å…¥
   - ãƒãƒ£ãƒƒãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°

### ğŸ“Š é€²æ—çŠ¶æ³
- **Phase 1ï¼ˆåŸºç›¤æ§‹ç¯‰ï¼‰**: 100% âœ…
- **Phase 2ï¼ˆLIFF Appï¼‰**: 0% ğŸš§
- **Phase 3ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ï¼‰**: 20%ï¼ˆDockerfileså®Œæˆï¼‰â³
- **å…¨ä½“é€²æ—**: ç´„40%

---

## 12. é‡è¦ãªè¨­è¨ˆæ±ºå®šã¨ç†ç”±

### 12.1 ãªãœGo Workspaceã‚’ä½¿ã†ã®ã‹ï¼Ÿ
**ç†ç”±:**
- å…±é€šã‚³ãƒ¼ãƒ‰ï¼ˆgo_pkgï¼‰ã‚’è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹ã§å…±æœ‰
- ä¾å­˜é–¢ä¿‚ã®ä¸€å…ƒç®¡ç†
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºæ™‚ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªçµ±åˆ

### 12.2 ãªãœLINE User IDã‚’å…±é€šè­˜åˆ¥å­ã«ã™ã‚‹ã®ã‹ï¼Ÿ
**ç†ç”±:**
- LINE Botã¯Supabaseèªè¨¼ã‚’çµŒç”±ã—ãªã„
- LINE User IDã¯ä¸€æ„ã§LINEãŒä¿è¨¼
- èªè¨¼ä¸è¦ã§ä¼šè©±å±¥æ­´ã‚’ä¿å­˜ã§ãã‚‹
- LIFFå´ã§LINE User IDã¨Supabase UUIDã‚’ãƒãƒƒãƒ”ãƒ³ã‚°

### 12.3 ãªãœCloudflare Pagesã§LIFFã‚’ãƒ›ã‚¹ãƒˆã™ã‚‹ã®ã‹ï¼Ÿ
**ç†ç”±:**
- Vercelã‚ˆã‚Šç„¡æ–™æ ãŒå¤§ãã„
- ã‚°ãƒ­ãƒ¼ãƒãƒ«CDNã§é«˜é€Ÿ
- Next.js App Routerå¯¾å¿œï¼ˆOpenNextçµŒç”±ï¼‰
- ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒé«˜ã„

### 12.4 ãªãœMiddlewareã§Supabase JWTæ¤œè¨¼ã™ã‚‹ã®ã‹ï¼Ÿ
**ç†ç”±:**
- èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®ä¸€å…ƒåŒ–
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å‘ä¸Š
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã”ã¨ã«èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒãªã„

### 12.5 ãªãœMageã‚’ä½¿ã†ã®ã‹ï¼Ÿ
**ç†ç”±:**
- Makefileã‚ˆã‚Šå‹å®‰å…¨
- Goé–‹ç™ºè€…ã«ã¨ã£ã¦è‡ªç„¶
- ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ
- è¤‡é›‘ãªãƒ“ãƒ«ãƒ‰ã‚¿ã‚¹ã‚¯ã‚‚è¨˜è¿°å¯èƒ½

---

## 13. ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

### Q1: LINE Botã¨LIFFã®ä¼šè©±ã¯æœ¬å½“ã«åŒæœŸã—ã¾ã™ã‹ï¼Ÿ
**A:** ã¯ã„ã€å®Œå…¨ã«åŒæœŸã—ã¾ã™ã€‚ä¸¡æ–¹ã¨ã‚‚åŒã˜Supabaseã®`conversations`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§ã—ã¦ã„ã‚‹ãŸã‚ã€ã©ã¡ã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‹ã‚‰ã§ã‚‚åŒã˜ä¼šè©±å±¥æ­´ãŒè¦‹ãˆã¾ã™ã€‚

### Q2: Geminiä»¥å¤–ã®LLMã‚‚ä½¿ãˆã¾ã™ã‹ï¼Ÿ
**A:** ã¯ã„ã€`go_pkg/llm`ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚Œã°ã€OpenAIã€Claudeç­‰ã‚‚ä½¿ç”¨ã§ãã¾ã™ã€‚

### Q3: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ä½¿ãˆã¾ã™ã‹ï¼Ÿ
**A:** ã¯ã„ã€LINE User IDã§è­˜åˆ¥ã•ã‚Œã‚‹ãŸã‚ã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæ™‚ã«åˆ©ç”¨ã§ãã¾ã™ã€‚

### Q4: ä¼šè©±å±¥æ­´ã¯ã©ã®ãã‚‰ã„ä¿å­˜ã•ã‚Œã¾ã™ã‹ï¼Ÿ
**A:** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç„¡åˆ¶é™ã§ã™ãŒã€å¤ã„ä¼šè©±ã‚’å‰Šé™¤ã™ã‚‹ãƒãƒƒãƒå‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

### Q5: æœ¬ç•ªç’°å¢ƒã®ã‚³ã‚¹ãƒˆã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ
**A:**
- **Supabase**: ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆ500MB DBã€2GBè»¢é€/æœˆï¼‰
- **Cloud Run**: å¾“é‡èª²é‡‘ï¼ˆæœˆ200ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ã§ç„¡æ–™ï¼‰
- **Cloudflare Pages**: ç„¡æ–™ãƒ—ãƒ©ãƒ³ï¼ˆç„¡åˆ¶é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
- **Gemini API**: å¾“é‡èª²é‡‘ï¼ˆ1æ—¥15ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ã§ç„¡æ–™ï¼‰

å°è¦æ¨¡åˆ©ç”¨ãªã‚‰æœˆé¡ã»ã¼ç„¡æ–™ã§é‹ç”¨å¯èƒ½ã§ã™ã€‚

---

## 14. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Issue 1: LIFFèªè¨¼ãŒå¤±æ•—ã™ã‚‹
**è§£æ±ºç­–:**
- LIFF IDãŒæ­£ã—ã„ã‹ç¢ºèª
- Backend URLãŒæ­£ã—ã„ã‹ç¢ºèª
- Supabase URLã¨ã‚­ãƒ¼ãŒæ­£ã—ã„ã‹ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®Cookieã‚’å‰Šé™¤

### Issue 2: LINE BotãŒå¿œç­”ã—ãªã„
**è§£æ±ºç­–:**
- Webhook URLãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- LINEç½²åæ¤œè¨¼ãŒé€šã£ã¦ã„ã‚‹ã‹ç¢ºèª
- Cloud Runã®ãƒ­ã‚°ã‚’ç¢ºèª
- Supabaseæ¥ç¶šãŒæ­£å¸¸ã‹ç¢ºèª

### Issue 3: ä¼šè©±ãŒåŒæœŸã—ãªã„
**è§£æ±ºç­–:**
- `conversations`ãƒ†ãƒ¼ãƒ–ãƒ«ã®`user_id`ãŒæ­£ã—ã„ã‹ç¢ºèª
- LINE User IDãŒæ­£ã—ãå–å¾—ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
- Supabaseã®ãƒ­ã‚°ã‚’ç¢ºèª

### Issue 4: Gemini APIãŒã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
**è§£æ±ºç­–:**
- API KeyãŒæœ‰åŠ¹ã‹ç¢ºèª
- ã‚¯ã‚©ãƒ¼ã‚¿ã‚’è¶…ãˆã¦ã„ãªã„ã‹ç¢ºèª
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒé©åˆ‡ã‹ç¢ºèª
- ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª

---

## 15. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«ã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã§ãã¾ã™ï¼š

### è¿½åŠ æ©Ÿèƒ½ã®ä¾‹
- **ç”»åƒèªè­˜**: Gemini Visionã‚’ä½¿ã£ãŸç”»åƒåˆ†æ
- **éŸ³å£°å¯¾å¿œ**: LINEéŸ³å£°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ–‡å­—èµ·ã“ã—
- **ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼**: LINE Botã®ãƒªãƒƒãƒãƒ¡ãƒ‹ãƒ¥ãƒ¼è¨­å®š
- **é€šçŸ¥æ©Ÿèƒ½**: å®šæœŸçš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é…ä¿¡
- **åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: ä¼šè©±çµ±è¨ˆã®å¯è¦–åŒ–
- **å¤šè¨€èªå¯¾å¿œ**: i18nã«ã‚ˆã‚‹å›½éš›åŒ–
- **ãƒãƒ¼ãƒ æ©Ÿèƒ½**: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã®å…±åŒåˆ©ç”¨

### ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆ
- **UI/UX**: LIFF Appã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºA
- **ä¼šè©±ãƒ•ãƒ­ãƒ¼**: ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®èª¿æ•´
- **ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**: è¿½åŠ ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
- **èªè¨¼**: OAuth2.0ã®è¿½åŠ ã‚µãƒãƒ¼ãƒˆ

---

## 16. ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³æ­“è¿

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚ˆã‚Šè‰¯ãã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ï¼š

- ğŸ› **ãƒã‚°å ±å‘Š**: Issueä½œæˆ
- ğŸ’¡ **æ©Ÿèƒ½ææ¡ˆ**: Discussioné–‹å§‹
- ğŸ“ **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ”¹å–„**: PRä½œæˆ
- ğŸ”§ **ã‚³ãƒ¼ãƒ‰æ”¹å–„**: PRä½œæˆ
- ğŸŒ **ç¿»è¨³**: å¤šè¨€èªREADME

---

## 17. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨ã‚µãƒãƒ¼ãƒˆ

**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹:** MIT License

ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯è‡ªç”±ã«ä½¿ç”¨ã€ä¿®æ­£ã€é…å¸ƒã§ãã¾ã™ã€‚
å•†ç”¨åˆ©ç”¨ã‚‚å¯èƒ½ã§ã™ã€‚

**ã‚µãƒãƒ¼ãƒˆ:**
- GitHub Issues: ãƒã‚°å ±å‘Š
- GitHub Discussions: è³ªå•ãƒ»ææ¡ˆ
- Pull Requests: ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

---

**ä»¥ä¸Šã§è©³ç´°ãªé–‹ç™ºè¨ˆç”»æ›¸ã¯å®Œæˆã§ã™ã€‚**

ã“ã®ãƒ—ãƒ©ãƒ³ã«å¾“ã£ã¦å®Ÿè£…ã‚’é€²ã‚ã‚‹ã“ã¨ã§ã€å …ç‰¢ã§å†åˆ©ç”¨å¯èƒ½ãª
LINE Bot + LIFF + Golang + Next.js ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒå®Œæˆã—ã¾ã™ã€‚

å®Ÿè£…é–‹å§‹ã®æº–å‚™ãŒã§ããŸã‚‰ã€Phase 1ã®Step 1ã‹ã‚‰é †ç•ªã«é€²ã‚ã¦ãã ã•ã„ï¼

